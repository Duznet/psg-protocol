# PSG-protocol (Platform shooter game protocol)

Протокол обмена сообщениями между клиентом и сервером

Сообщения передаются в формате JSON

## Формат сообщений

### Запрос (Request)

    {
        // Самое действие
        "action": "<action>",

        // Параметры, специфичные для конкретного действия
        "params": {
            "<paramName1>": <paramValue1>,
            ...
        }
    }

#### Пример

    {
        "action": "signup",
        "params": {
            "login": "admin",
            "password": "banana"
        }
    }


### Ответ (Response)

    {
        // В случае успешного выполнения команды "<result>" == "ok".
        // В случае ошибки передается ее код
        "result": "<result>",

        // Текстовый комментарий. Может быть произвольным
        "message": "<message>"
    }

#### Пример ответа в случае успеха

    {
        "result": "ok"
    }

#### Пример ответа в случае ошибки

    {
        "result": "userExists",
        "message": "Такой пользователь уже существует"
    }


## Действия

### signup

Параметры:

* login => строковое значение.
    - минимальная длина: 4 символа
    - макисмальная длина: 40 символов
* password => строковое значение.
    - минимальная длина: 4 символа

Коды ошибок:

* userExists (Такой пользователь уже существует)
* badLogin (Некорректный логин)
* badPassword (Некорректный пароль)

### signin

Параметры:

* login => строковое значение
    - минимальная длина: 4 символа
    - макисмальная длина: 40 символов
* password => строковое значение
    - минимальная длина: 4 символа

Ответ:

* sid => латинские буквы и цифры, не короче 1 символа

Коды ошибок:

* incorrect (Некорректный логин/пароль)

### signout

Параметры:

* sid => латинские буквы и цифры, не короче 1 символа

Коды ошибок:

* badSid (Некорректный sid)

---

### sendMessage

Параметры:

* sid => латинские буквы и цифры, не короче 1 символа
* game => число, идентификатор игры. Пустая строка -- для общего чата
* text => текст сообщения, строковое значение

Коды ошибок:

* badSid (Некорректный sid)
* badGame (Некорректный идентификатор игры)

### getMessages

Параметры:

* sid => латинские буквы и цифры, не короче 1 символа
* game => число, идентификатор игры. Пустая строка -- для общего чата
* since => Unix timestamp UTC

Ответ:

* messages => массив, отсортированный *по возрастанию* времени

Элемент массива messages:

    {
        // Время в формате Unix timestamp UTC
        "time": <time>,

        // Текст сообщения
        "text": "<text>",

        // Логин отправителя
        "login": "<login>"
    }

    - time => Unix timestamp UTC
    - text => строковое значение
    - login => строковое значение
        + минимальная длина: 4 символа
        + максимальная длина: 40 символов

Коды ошибок:

* badSid (Некорректный sid)
* badGame (Некорректный идентификатор игры)
